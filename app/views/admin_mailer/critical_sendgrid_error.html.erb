<!DOCTYPE html>
<html>
<head>
  <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; }
    .container { max-width: 600px; margin: 20px auto; padding: 20px; }
    .alert { background: #fee; border: 2px solid #c33; border-radius: 4px; padding: 15px; margin: 20px 0; }
    .code { background: #f5f5f5; border: 1px solid #ddd; padding: 10px; font-family: monospace; font-size: 12px; overflow-x: auto; }
    h1 { color: #c33; }
    h2 { color: #333; margin-top: 30px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸš¨ Critical SendGrid Error</h1>

    <div class="alert">
      <strong>Action Required:</strong> This error indicates a problem with your SendGrid domain authentication.
      Emails are being rejected by recipient mail servers.
    </div>

    <h2>Error Details</h2>
    <p><strong>Failed Email:</strong> <%= @email %></p>
    <p><strong>Time:</strong> <%= @timestamp.strftime("%B %d, %Y at %I:%M %p %Z") %></p>
    <p><strong>Reason:</strong></p>
    <div class="code"><%= @reason %></div>

    <h2>What This Means</h2>
    <p>
      The error "Sender address rejected: Domain not found" means the receiving mail server
      cannot validate your SendGrid domain authentication. This is causing legitimate emails
      to be rejected.
    </p>

    <h2>How to Fix</h2>
    <ol>
      <li><strong>Check SendGrid Domain Authentication:</strong>
        <ul>
          <li>Go to SendGrid Dashboard â†’ Settings â†’ Sender Authentication</li>
          <li>Verify that <code>voxxypresents.com</code> shows as "Verified" (green checkmark)</li>
          <li>If not verified, check that all DNS records are properly configured</li>
        </ul>
      </li>
      <li><strong>DNS Records Required:</strong>
        <ul>
          <li>CNAME records for DKIM (s1._domainkey and s2._domainkey)</li>
          <li>CNAME record for mail subdomain</li>
        </ul>
      </li>
      <li><strong>After Fixing:</strong>
        <ul>
          <li>Go to SendGrid Dashboard â†’ Suppressions â†’ Bounces</li>
          <li>Search for and remove <%= @email %> from the bounce list</li>
          <li>The email can then receive messages again</li>
        </ul>
      </li>
    </ol>

    <h2>Full Event Data</h2>
    <div class="code">
      <%= JSON.pretty_generate(@event_data.as_json) %>
    </div>

    <hr style="margin: 30px 0; border: none; border-top: 1px solid #ddd;">
    <p style="font-size: 12px; color: #666;">
      This is an automated alert from the Voxxy Presents email monitoring system.
    </p>
  </div>
</body>
</html>
